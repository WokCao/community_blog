<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <title>Posts - Community Blog</title>
    <link th:href="@{/css/output.css}" rel="stylesheet">
    <script th:src="@{/js/tag-colors.js}" defer></script>
    <script th:src="@{/js/tag-overflow.js}" defer></script>
    <script th:src="@{/js/notification.js}" defer></script>
    <script th:src="@{/js/sidebar.js}" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gradient-to-br from-slate-50 to-indigo-50 min-h-screen">
<div th:replace="~{fragments/navbar :: navbar}"></div>

<!--Main Content-->
<div class="container mx-auto px-4 py-8">
    <div class="mb-8 animate-fade-in-up">
        <h1 class="text-4xl font-bold text-gray-800 mb-2">Explore Posts</h1>
        <p class="text-gray-600">Discover amazing content from our community</p>
    </div>
    <!--    Search and Filter Section-->
    <div class="bg-white rounded-2xl shadow-lg p-6 mb-8 animate-fade-in-up delay-100">
        <form th:action="@{/posts}" method="get" class="space-y-4">

            <!-- ðŸ” Search Bar -->
            <div class="grid md:grid-cols-3 gap-4">
                <div class="md:col-span-2">
                    <div class="relative">
                        <i class="fas fa-search absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        <label>
                            <input
                                    type="text"
                                    name="search"
                                    th:value="${search}"
                                    placeholder="Search by tags, post's title, author ..."
                                    class="w-full pl-12 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all text-gray-900 placeholder-gray-400 text-sm lg:text-base">
                        </label>
                    </div>
                </div>
            </div>

            <!-- ðŸ§­ Filter & Sort Controls -->
            <div class="flex flex-wrap gap-3 items-end">

                <!-- Sort By -->
                <div>
                    <label for="sortBy"></label><select id="sortBy" name="sortBy" th:value="${sortBy}"
                                                        class="px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all text-sm lg:text-base text-gray-900">
                        <option value="createdAt" th:selected="${sortBy == 'createdAt' or sortBy == null}">
                            Latest Posts
                        </option>
                        <option value="highPoint" th:selected="${sortBy == 'highPoint'}">
                            High Point (Most Popular)
                        </option>
                    </select>
                </div>

                <!-- Sort Direction -->
                <div>
                    <label for="sortDir"></label><select id="sortDir" name="sortDir" th:value="${sortDir}"
                                                         class="px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all text-sm lg:text-base text-gray-900">
                        <option value="desc" th:selected="${sortDir == 'desc' or sortDir == null}">
                            Descending
                        </option>
                        <option value="asc" th:selected="${sortDir == 'asc'}">
                            Ascending
                        </option>
                    </select>
                </div>

                <!-- Search Button -->
                <button type="submit"
                        class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold px-6 py-2 rounded-xl hover:from-indigo-700 hover:to-purple-700 transform hover:scale-105 transition-all duration-300 shadow-lg">
                    <i class="fas fa-search mr-2"></i>Search
                </button>

                <!-- Reset Button -->
                <a th:href="@{/posts}"
                   class="bg-gray-200 text-gray-700 font-semibold px-6 py-2 rounded-xl hover:bg-gray-300 transform hover:scale-105 transition-all duration-300">
                    <i class="fas fa-redo mr-2"></i>Reset
                </a>

            </div>
        </form>
    </div>

    <!--    Results Info-->
    <div class="mb-6">
        <p class="text-gray-600 text-sm lg:text-base">
                <span th:if="${search != null and search != ''}" class="font-medium">
                    Search results for "<span th:text="${search}"></span>" -
                </span>
            Showing <span class="font-medium" th:text="${posts.size()}"></span> posts
        </p>
    </div>

    <!--    Posts Grid-->
    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
        <!--        Post Card-->
        <div th:each="post, iterStat : ${posts}"
             th:class="'bg-white rounded-2xl shadow-lg overflow-hidden hover-lift animate-fade-in-up delay-' + ${(iterStat.index + 2) * 100}">
            <div class="relative h-48 bg-gradient-to-br from-indigo-400 to-purple-500 overflow-hidden">
                <img th:if="${post.thumbnailUrl}" th:src="@{${post.thumbnailUrl}}" alt="Post thumbnail"
                     class="w-full h-full object-cover">
                <div th:unless="${post.thumbnailUrl}" class="w-full h-full flex items-center justify-center">
                    <i class="fas fa-image text-white text-6xl opacity-50"></i>
                </div>
                <div class="absolute top-4 right-4">
                            <span class="bg-white text-indigo-600 px-3 py-1 rounded-full text-sm font-semibold shadow-lg">
                                <i class="fas fa-tag mr-1"></i><span>Topic</span>
                            </span>
                </div>
            </div>

            <div class="p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-3 hover:text-indigo-600 transition-colors line-clamp-1">
                    <a th:href="@{/posts/{id}(id=${post.id})}" th:text="${post.title}">Post Title</a>
                </h3>

                <p class="text-gray-600 mb-4 line-clamp-3" th:text="${post.plainContent}"></p>

                <div class="relative flex flex-wrap items-center gap-2 tag-row max-w-full overflow-hidden mb-4">
                    <div class="absolute right-0 top-0 bottom-0 w-10 bg-gradient-to-l from-white pointer-events-none"></div>
                    <span th:each="tag : ${post.tags}"
                          class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium tag-pill bg-gray-100 text-gray-700 border border-gray-200 text-nowrap"
                          th:text="${tag}">
                        </span>
                </div>

                <div class="flex items-center justify-between pt-4 border-t border-gray-100">
                    <div class="flex items-center space-x-3">
                        <img th:src="@{${post.author.avatarUrl}}" alt="Author"
                             class="w-10 h-10 rounded-full border-2 border-indigo-200">
                        <div>
                            <div class="font-semibold text-gray-800 text-sm" th:text="${post.author.fullName}">
                                Author Name
                            </div>
                            <div class="text-xs text-gray-500" th:text="${post.timeAgo}">Date</div>
                        </div>
                    </div>

                    <div class="flex items-center space-x-4 text-sm text-gray-500">
                            <span class="flex items-center hover:text-indigo-600 transition-colors">
                                    <i class="fa-solid fa-eye mr-1"></i>
                                    <span th:text="${post.formattedViewCount}">0</span>
                                </span>
                        <span class="flex items-center hover:text-indigo-600 transition-colors">
                                    <i class="fas fa-heart mr-1"></i>
                                    <span th:text="${post.likeCount}">0</span>
                                </span>
                        <span class="flex items-center hover:text-indigo-600 transition-colors">
                                    <i class="fas fa-comment mr-1"></i>
                                    <span th:text="${post.commentCount}">0</span>
                                </span>
                    </div>
                </div>

            </div>
        </div>

        <!--        Empty State-->
        <div th:if="${#lists.isEmpty(posts)}" class="text-center py-16 animate-fade-in-up delay-200">
            <i class="fas fa-search text-gray-300 text-6xl mb-4"></i>
            <p class="text-gray-500 text-lg mb-2">No posts found</p>
            <p class="text-gray-400">Try adjusting your search or filters</p>
        </div>
    </div>

    <!-- Pagination -->
    <div th:if="${totalPages > 1}" class="mt-8 flex items-center justify-center space-x-2 animate-fade-in-up delay-300">

        <!-- Previous Button -->
        <a th:href="@{/posts(page=${currentPage - 1}, search=${search}, sortBy=${sortBy}, sortDir=${sortDir})}"
           th:classappend="${currentPage == 0} ? 'pointer-events-none opacity-50' : 'hover:bg-indigo-50 hover:border-indigo-300'"
           class="px-3 py-2 bg-white border border-gray-300 rounded-lg text-gray-700 transition-all">
            <i class="fas fa-chevron-left"></i>
        </a>

        <!-- First Page -->
        <a th:href="@{/posts(page=0, search=${search}, sortBy=${sortBy}, sortDir=${sortDir})}"
           th:classappend="${currentPage == 0} ? 'bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold pointer-events-none' : 'bg-white border border-gray-300 text-gray-700 hover:bg-indigo-50 hover:border-indigo-300'"
           class="px-3 py-2 rounded-lg transition-all"
           th:text="1"></a>

        <!-- Left Ellipsis -->
        <span th:if="${currentPage > 2}" class="px-2 text-gray-500 select-none">...</span>

        <!-- Middle Pages -->
        <a th:each="i : ${#numbers.sequence(currentPage - 1, currentPage + 1)}"
           th:if="${i > 0 and i < totalPages - 1}"
           th:href="@{/posts(page=${i}, search=${search}, sortBy=${sortBy}, sortDir=${sortDir})}"
           th:classappend="${i == currentPage} ? 'bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold pointer-events-none' : 'bg-white border border-gray-300 text-gray-700 hover:bg-indigo-50 hover:border-indigo-300'"
           class="px-3 py-2 rounded-lg transition-all"
           th:text="${i + 1}"></a>

        <!-- Right Ellipsis -->
        <span th:if="${currentPage < totalPages - 3}" class="px-2 text-gray-500 select-none">...</span>

        <!-- Last Page -->
        <a th:href="@{/posts(page=${totalPages - 1}, search=${search}, sortBy=${sortBy}, sortDir=${sortDir})}"
           th:classappend="${currentPage == totalPages - 1} ? 'bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold pointer-events-none' : 'bg-white border border-gray-300 text-gray-700 hover:bg-indigo-50 hover:border-indigo-300'"
           class="px-3 py-2 rounded-lg transition-all"
           th:text="${totalPages}"></a>

        <!-- Next Button -->
        <a th:href="@{/posts(page=${currentPage + 1}, search=${search}, sortBy=${sortBy}, sortDir=${sortDir})}"
           th:classappend="${currentPage == totalPages - 1} ? 'pointer-events-none opacity-50' : 'hover:bg-indigo-50 hover:border-indigo-300'"
           class="px-3 py-2 bg-white border border-gray-300 rounded-lg text-gray-700 transition-all">
            <i class="fas fa-chevron-right"></i>
        </a>

    </div>

</div>

<div th:replace="~{fragments/footer :: footer}"></div>
</body>
</html>
